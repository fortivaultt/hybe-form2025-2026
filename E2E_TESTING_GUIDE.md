# End-to-End (E2E) Testing Guide

This guide provides step-by-step instructions for running the end-to-end (E2E) test suite for the HYBE Fan-Permit Form. The test simulates a complete user journey, from filling out the form to verifying an email via OTP and reaching the success page.

**Test File:** `tests/e2e-flow.spec.js`
**Framework:** [Playwright](https://playwright.dev/)

---

## 1. Prerequisites

Before you can run the test, you need to set up your local environment.

### a. Install Dependencies

If you haven't already, install the project's npm dependencies:

```bash
npm install
```

### b. Install Playwright

The E2E test requires Playwright and its browser binaries.

1.  **Install Playwright:**
    ```bash
    npm install --save-dev @playwright/test
    ```

2.  **Install Browsers:**
    ```bash
    npx playwright install
    ```

---

## 2. Environment Setup

The test requires several environment variables to function correctly, including credentials for Supabase, Formspree, and an email testing service.

### a. Create the `.env` File

Create a file named `.env` in the root of the project directory.

### b. Add Application Variables

Add the following variables for the application to connect to the necessary services. Replace the placeholder values with your actual credentials.

```env
# Supabase Credentials
VITE_SUPABASE_URL="https://your-project-url.supabase.co"
VITE_SUPABASE_ANON_KEY="your-supabase-public-anon-key"

# Formspree Endpoint
VITE_FORMSPREE_URL="https://formspree.io/f/your-form-id"
```

### c. Set Up an Email Testing Service (Mailosaur)

To automatically receive and read the OTP email during the test, you need a programmatic email testing service. The test scaffold is written to use [Mailosaur](https://mailosaur.com), but any similar service will work with minor adjustments to the test script.

1.  **Sign up for Mailosaur:** Create an account and a new Server.
2.  **Get Your Credentials:** Find your Server ID and API Key in the Mailosaur dashboard.
3.  **Add Mailosaur Variables to `.env`:**

    ```env
    # Mailosaur Credentials
    MAILOSAUR_API_KEY="your-mailosaur-api-key"
    MAILOSAUR_SERVER_ID="your-mailosaur-server-id"
    ```

Your final `.env` file should look like this:

```env
# Supabase Credentials
VITE_SUPABASE_URL="https://your-project-url.supabase.co"
VITE_SUPABASE_ANON_KEY="your-supabase-public-anon-key"

# Formspree Endpoint
VITE_FORMSPREE_URL="https://formspree.io/f/your-form-id"

# Mailosaur Credentials
MAILOSAUR_API_KEY="your-mailosaur-api-key"
MAILOSAUR_SERVER_ID="your-mailosaur-server-id"
```

---

## 3. Running the Test

Follow these steps to execute the E2E test.

### a. Start the Development Server

The test needs the application to be running. Open a terminal and start the Vite development server:

```bash
npm run dev
```

The server will typically start on `http://localhost:5173`.

### b. Execute the Playwright Test

Open a **second terminal** and run the following command to start the Playwright test runner:

```bash
npx playwright test tests/e2e-flow.spec.js
```

Playwright will launch a browser, navigate to the application, and perform the following actions:
1.  Fill out all required fields in the subscription form with test data.
2.  Use a unique, temporary email address generated by Mailosaur.
3.  Submit the form to trigger the OTP verification modal.
4.  Use the Mailosaur API to fetch the OTP code from the email that was just sent.
5.  Enter the OTP code into the modal to complete the verification.
6.  Confirm that the form submission is successful and that the user is redirected to the success page.

If all steps complete successfully, the test will pass, confirming that the entire form submission system is working as expected.